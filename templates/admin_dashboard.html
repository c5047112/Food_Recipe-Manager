<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Admin Dashboard | Recipe Manager</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>

<body>

<nav class="navbar navbar-dark bg-dark">
    <div class="container">
        <span class="navbar-brand">üë©‚Äçüç≥ Admin Panel - {{ username }}</span>
        <a href="{{ url_for('admin_requests') }}" class="btn btn-info me-2">Requests</a>
        <a href="{{ url_for('logout') }}" class="btn btn-warning">Logout</a>
    </div>
</nav>

<div class="container mt-5">

    <h2>All Users & Recipes</h2>
    <hr>

    {% if users %}
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>User ID</th>
                <th>Name</th>
                <th>Email</th>
                <th>Total Recipes</th>
                <th>View</th>
            </tr>
        </thead>
        <tbody>
            {% for u in users %}
            <tr>
                <td>{{ u["id"] }}</td>
                <td>{{ u["username"] }}</td>
                <td>{{ u["email"] }}</td>
                <td>{{ u["recipe_count"] }}</td>
                <td>
                    <button class="btn btn-primary btn-sm"
                            onclick="openRecipePopup({{ u['id'] }}, '{{ u['username'] }}')">
                        View Recipes
                    </button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
        <p>No users found.</p>
    {% endif %}

</div>

<!-- ==============================
     BOOTSTRAP MODAL FOR RECIPES
============================== -->
<div class="modal fade" id="recipeModal" tabindex="-1">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      
      <div class="modal-header">
        <h5 class="modal-title">Recipes by <span id="modalUserName"></span></h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">
        <table class="table table-striped">
          <thead>
            <tr>
              <th>Recipe ID</th>
              <th>Title</th>
              <th>Category</th>
            </tr>
          </thead>
          <tbody id="recipeTableBody">
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<script>
function openRecipePopup(userId, username) {
    document.getElementById("modalUserName").innerText = username;

    fetch(`/admin/get_user_recipes/${userId}`)
        .then(res => res.json())
        .then(data => {
            let tbody = document.getElementById("recipeTableBody");
            tbody.innerHTML = "";

            if (data.recipes.length === 0) {
                tbody.innerHTML = `<tr><td colspan="3" class="text-center">No recipes found</td></tr>`;
                return;
            }

            data.recipes.forEach(r => {
                tbody.innerHTML += `
                    <tr>
                        <td>${r.id}</td>
                        <td>${r.title}</td>
                        <td>${r.category}</td>
                    </tr>
                `;
            });
        });

    new bootstrap.Modal(document.getElementById("recipeModal")).show();
}
</script>

</body>
</html>
